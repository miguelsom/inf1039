{% extends "base.html" %}

{% block title %}GradGuru ‚Ä¢ Disciplinas{% endblock %}

{% block content %}
<div class="disciplinas-wrapper">
  <!-- Filtros Laterais -->
  <aside class="filtros">
    <h3>Filtrar por</h3>

    <div class="filtro-box">
      <label><strong>Tipo:</strong></label>
      <label><input type="radio" name="tipo" class="filtro" data-col="tipo" value=""> Todas</label>
      <label><input type="radio" name="tipo" class="filtro" data-col="tipo" value="Obrigat√≥ria"> Obrigat√≥ria</label>
      <label><input type="radio" name="tipo" class="filtro" data-col="tipo" value="Eletiva"> Eletiva</label>
    </div>

    <div class="filtro-box">
      <label for="graduacao"><strong>Gradua√ß√£o:</strong></label>
      <select id="graduacao" class="filtro" data-col="graduacao">
        <option value="">Todas</option>
        <option value="Engenharia">Engenharia</option>
        <option value="Computa√ß√£o">Computa√ß√£o</option>
      </select>
    </div>

    <div class="filtro-box">
      <label for="departamento"><strong>Departamento:</strong></label>
      <select id="departamento" class="filtro" data-col="departamento">
        <option value="">Todos</option>
        <option value="Inform√°tica">Inform√°tica</option>
        <option value="Matem√°tica">Matem√°tica</option>
      </select>
    </div>

    <button class="botao-aplicar" onclick="aplicarFiltros()">Aplicar Filtros</button>
  </aside>

  <!-- Conte√∫do Principal -->
  <section class="disciplinas-conteudo">
    <div class="search-bar search-pequena">
      <input type="text" id="search" placeholder="üîç Buscar disciplina..." />
    </div>

    <div class="section no-padding">
      <table class="disciplinas-tabela">
        <thead>
          <tr>
            <th>C√≥digo</th>
            <th>Nome</th>
            <th>Departamento</th>
            <th>Gradua√ß√£o</th>
            <th>Tipo</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="disciplinas-tabela">
          <tr data-codigo="INF1010" data-nome="Algoritmos" data-departamento="Inform√°tica" data-graduacao="Engenharia" data-tipo="Obrigat√≥ria">
            <td>INF1010</td>
            <td>Algoritmos</td>
            <td>Inform√°tica</td>
            <td>Engenharia</td>
            <td>Obrigat√≥ria</td>
            <td><a href="/disciplina/algoritmos/">Ver</a></td>
          </tr>
          <tr data-codigo="INF2020" data-nome="Design de Interfaces" data-departamento="Inform√°tica" data-graduacao="Computa√ß√£o" data-tipo="Eletiva">
            <td>INF2020</td>
            <td>Design de Interfaces</td>
            <td>Inform√°tica</td>
            <td>Computa√ß√£o</td>
            <td>Eletiva</td>
            <td><a href="/disciplina/interfaces/">Ver</a></td>
          </tr>
          <tr data-codigo="MAT1001" data-nome="C√°lculo I" data-departamento="Matem√°tica" data-graduacao="Engenharia" data-tipo="Obrigat√≥ria">
            <td>MAT1001</td>
            <td>C√°lculo I</td>
            <td>Matem√°tica</td>
            <td>Engenharia</td>
            <td>Obrigat√≥ria</td>
            <td><a href="/disciplina/calculo1/">Ver</a></td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>

<script>
  function aplicarFiltros() {
    const busca = document.getElementById('search').value.trim().toLowerCase();
    const tipoSelecionado = document.querySelector('input[name="tipo"]:checked')?.value.trim().toLowerCase() || "";
    const graduacao = document.getElementById('graduacao').value.trim().toLowerCase();
    const departamento = document.getElementById('departamento').value.trim().toLowerCase();

    const linhas = document.querySelectorAll('#disciplinas-tabela tr');

    linhas.forEach(row => {
      const texto = row.innerText.toLowerCase();
      let mostrar = texto.includes(busca);

      const tipo = (row.dataset.tipo || "").trim().toLowerCase();
      const grad = (row.dataset.graduacao || "").trim().toLowerCase();
      const dept = (row.dataset.departamento || "").trim().toLowerCase();

      if (tipoSelecionado && tipo !== tipoSelecionado) mostrar = false;
      if (graduacao && grad !== graduacao) mostrar = false;
      if (departamento && dept !== departamento) mostrar = false;

      row.style.display = mostrar ? "" : "none";
    });
  }

  document.getElementById('search').addEventListener('input', aplicarFiltros);

  // ================================
  // Aplicar filtros com base na URL
  // ================================
  window.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);

    // Pr√©-seleciona radio de tipo
    const tipo = params.get('tipo');
    if (tipo) {
      const radio = document.querySelector(`input[name="tipo"][value="${tipo}"]`);
      if (radio) radio.checked = true;
    }

    // Pr√©-seleciona gradua√ß√£o
    const graduacao = params.get('graduacao');
    if (graduacao) {
      const select = document.getElementById('graduacao');
      if (select) select.value = graduacao;
    }

    // Pr√©-seleciona departamento
    const departamento = params.get('departamento');
    if (departamento) {
      const select = document.getElementById('departamento');
      if (select) select.value = departamento;
    }

    // Aplica os filtros
    aplicarFiltros();
  });
</script>

{% endblock %}
